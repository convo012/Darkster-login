<!DOCTYPE html>
<html>
  <head>
    <title>Login page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-image: url("spid.jpg");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        width: 100%;
        height: 100%;
        color: #ffffff;
        overflow: hidden !important;
      }
    </style>
  </head>
  <body>
    <script>
      fetch("/token", {
        method: "GET",
        headers: { "Content-Type": "application/json" },
      })
        .then((a) => a.json())
        .then((a) => {
          if (a.success == true) return (window.location.href = "/dashboard");
        });
      function login() {
        Swal.fire({
          title: "Input Login Details",
          html: `
  <div style="overflow: hidden; color:#ffffff;">
  <input type="text" id="login" class="swal2-input" placeholder="Username" style="margin-left: 0; width: 100%;">
  <input type="text" id="password" class="swal2-input" placeholder="Password" style="margin-left: 0; width: 100%;">
  </div>
  `,
          confirmButtonText: "Login",
          focusConfirm: false,
          preConfirm: () => {
            const login = Swal.getPopup().querySelector("#login").value;
            const password = Swal.getPopup().querySelector("#password").value;
            if (!login || !password) {
              Swal.showValidationMessage(`Please enter login and password`);
            }
            return { login: login, password: password };
          },
          didOpen: () => {
            const modal = Swal.getPopup();
            modal.style.backgroundColor = "#00000000";
          },
        }).then((result) => {
          if (result.isDismissed == true) return login();

          if (result.isConfirmed == true) {
            fetch("/form", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                username: result.value.login,
                pass: result.value.password,
              }),
            })
              .then((a) => a.json())
              .then((a) => {
                if (a.success == true) {
                  document.cookie = `key=${a.key}; expires=Fri, 31 Dec 9999 23:59:59 GMT`;
                  return Swal.fire(
                    "Login successfully",
                    "Login successfully you can go to spam tool now!!",
                    "success"
                  ).then((a) => {
                    return (window.location.href = "/dashboard");
                  });
                } else {
                  return Swal.fire(
                    "Login error",
                    "Wrong username or password!",
                    "error"
                  ).then((a) => {
                    return login();
                  });
                }
              });
          }
        });
      }
      login();
    </script>
  </body>
</html>
